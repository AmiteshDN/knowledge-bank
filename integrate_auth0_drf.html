<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <title>Securing Django REST APIs with Auth0 OAuth</title>
  </head>
  <body>
    <nav class="navbar navbar-light bg-light">
            <span class="navbar-brand mb-0 h1">DEVELOPER DUMP</span>
        </nav>
    <div class="container">
        <a  class="btn btn-sm btn-primary" href="index.html">Index</a>
        <h1 class="">Securing Django REST APIs with Auth0 OAuth</h1>
        <p><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
  <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
</svg><a href="https://www.linkedin.com/in/vdn-amitesh/"> Amitesh</a> <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-event" viewBox="0 0 16 16">
  <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
  <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5M1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
</svg> Oct 30 2025</span></p>
<hr>
        <p>Download the PDF version of this Article here: <a href="media/integrate_oauth_drf/pdfs/Securing Django REST APIs with Auth0 OAuth.pdf">Download <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
</svg></a></p>
        <p>This guide explains how to secure Django REST Framework (DRF) APIs using Auth0 OAuth, including JWT validation, custom authentication, and DRF permission enforcement.</p>
        <div class="alert alert-warning" role="alert">
        ⚠️ Note: This setup is intended for DRF-based API endpoints, not Django template-based views. For traditional Django authentication, refer to <a href="https://auth0.com/docs/quickstart/webapp/django/interactive" class="alert-link">Auth0 Django guide <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
</svg></a>
        </div>
        <hr>
        <div class="content">
            <h4>Configure Auth0  </h4>
            <div class="alert alert-info" role="alert">
                <small><i><a href="https://manage.auth0.com/dashboard/us/dev-qveoo10p8efuoeiu/apis" target="_blank" class="alert-link">Configure api in auth0 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707z"/>
</svg></a></i></small>
            </div>
            <p><b>Steps:</b></p>
                <ol>
                    <li>Create a new API in Auth0:</li>
                    <ul>
                        <li>Name: AssignMate API</li>
                        <li>Identifier (Audience):<var>http://localhost:8000/users</var> </li>
                        
                    </ul>
                    <li>Create an Application (machine-to-machine or SPA).</li>
                    <ul>
                        <li>Note Client ID and Client Secret</li>
                        <li>Associate your application with the API.</li>
                    </ul>
                </ol>
                <p>Purpose: Only tokens issued for your API audience will be valid. Auth0 acts as the trusted authentication server.</p>

            <hr>    
            <h4>Install Dependencies</h4>
            <pre><code>pip install authlib python-dotenv djangorestframework</code></pre>
            <p><mark>authlib</mark> → JWT parsing and validation</p>
            <p><mark>python-dotenv</mark> → Load environment variables</p>
            <p><mark>djangorestframework</mark>  → API framework</p>
            <hr>

            <h4>Django Settings <i>settings.py</i></h4>
                <pre>
                    <code>
                            REST_FRAMEWORK = {
                                'DEFAULT_AUTHENTICATION_CLASSES': [
                                    'users.authentication.Auth0Authentication',
                                    'rest_framework.authentication.SessionAuthentication',
                                ],
                                'DEFAULT_PERMISSION_CLASSES': [
                                    'rest_framework.permissions.IsAuthenticated',
                                ],
                            }

                            AUTH0_DOMAIN = os.environ.get("AUTH0_DOMAIN")
                            AUTH0_AUDIENCE = os.environ.get("AUTH0_AUDIENCE")

                    </code>
                </pre>
            <p>Purpose: Configures DRF to use custom authentication and ensures only authenticated users can access endpoints.</p>
            <hr>
            <h4>JWT Validator <i>users/validator.py</i></h4>
            <pre>
                <code>
                    import json
                    from urllib.request import urlopen
                    from authlib.oauth2.rfc7523 import JWTBearerTokenValidator
                    from authlib.jose.rfc7517 import JsonWebKey

                    class Auth0JWTBearerTokenValidator(JWTBearerTokenValidator):
                        def __init__(self, domain, audience):
                            self.issuer = f"https://{domain}/"
                            self.audience = audience
                            jwks_url = f"https://{domain}/.well-known/jwks.json"
                            with urlopen(jwks_url) as response:
                                jwks_data = json.load(response)
                            self.jwks = JsonWebKey.import_key_set(jwks_data)
                            super().__init__(self.jwks)
                            self.claims_options = {
                                "iss": {"essential": True, "value": self.issuer},
                                "aud": {"essential": True, "value": self.audience},
                                "exp": {"essential": True},
                            }

                </code>
            </pre>
            <p>Purpose:</p>
            <ul>
                <li>Fetch Auth0 JWKS (public keys)</li>
                <li>Validate JWT signature and essential claims (iss, aud, exp)</li>
            </ul>
            <hr>
            <h4>Custom Authentication Class <i>users/authentication.py</i></h4>
            <pre>
                <code>
                    import os
                    from rest_framework.authentication import BaseAuthentication
                    from rest_framework.exceptions import AuthenticationFailed
                    from .validator import Auth0JWTBearerTokenValidator

                    class Auth0Authentication(BaseAuthentication):
                        def __init__(self):
                            self.validator = Auth0JWTBearerTokenValidator(
                                os.environ.get("AUTH0_DOMAIN"),
                                os.environ.get("AUTH0_AUDIENCE"),
                            )

                        def authenticate(self, request):
                            auth = request.headers.get("Authorization")
                            if not auth or not auth.startswith("Bearer "):
                                return None
                            token = auth.split(" ")[1]
                            try:
                                claims = self.validator.authenticate_token(token)
                                if not claims:
                                    raise AuthenticationFailed("Invalid token")

                                # Map Auth0 'sub' claim to Django User
                                from django.contrib.auth import get_user_model
                                User = get_user_model()
                                user, _ = User.objects.get_or_create(username=claims['sub'])
                                return (user, token)
                            except Exception as e:
                                raise AuthenticationFailed(f"Token validation failed: {e}")

                </code>
            </pre>
            <p>Purpose:</p>
            <ul>
                <li>Extracts JWT from <mark>Authorization</mark> header</li>
                <li>Validates token with Auth0 JWKS</li>
                <li>Returns Django <mark>User</mark> object to satisfy DRF permission checks</li>
            </ul>
            <hr>
            <h4>Protected DRF Viewsets <i>users/views.py</i></h4>
            <pre>
                <code>
                    from rest_framework import viewsets
                    from rest_framework.permissions import IsAuthenticated
                    from .serializers import UserSerializer
                    from django.contrib.auth import get_user_model
                    from .authentication import Auth0Authentication

                    User = get_user_model()

                    class UserViewSet(viewsets.ModelViewSet):
                        queryset = User.objects.all()
                        serializer_class = UserSerializer
                        authentication_classes = [Auth0Authentication]
                        permission_classes = [IsAuthenticated]

                </code>
                
            </pre>
            <p>Purpose:</p>
                <ul>
                    <li>Ensures all requests to this viewset are authenticated using Auth0 JWT</li>
                    <li><mark>IsAuthenticated</mark> checks the <mark>user</mark> object returned by the authentication class</li>
                </ul>
            <hr>
            <h4>How the flow works</h4>
            <ol>
                <li>Client requests token from Auth0 using your API audience.</li>
                <li>Token is sent in Authorization: Bearer <i><mark>token</mark></i> header to Django API.</li>
                <li>DRF calls Auth0Authentication:</li>
                <ul>
                    <li>Validates token signature</li>
                    <li>Confirms <mark>aud</mark> claim matches your API</li>
                    <li>Returns a Django <mark>User</mark> object</li>
                </ul>
                <li>DRF permission classes <mark>IsAuthenticated</mark> allow or deny access based on the returned <mark>user</mark>.</li>
            
            </ol>
            <p>Purpose: Only authenticated users from Auth0 can access the API, and DRF framework contracts are respected.</p>
            <hr>
            <h4>Key lessons</h4>
            <ul>
                <li>Audience <mark>aud</mark> claim ensures tokens are intended for your API.</li>
                <li>DRF expects <mark>user, token</mark> from <mark>authenticate();</mark> </li>
                <li>permissions rely on the <mark>user</mark> object.</li>
            </ul>
            <hr>
            <p class="alert alert-info" role="alert">✅ Outcome: DRF APIs are secured with Auth0 OAuth; only authenticated users can access endpoints. Next step could be implementing scope-based authorization for role-specific access.</p>
        </div>
    </div>
    <div>

    </div>
    <footer>
        <div class="container">
            <hr>
            <p><small>© 2025 Amitesh VDN. All rights reserved.</small></p>
            <a href="https://github.com/AmiteshDN"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
</svg></a> <a href="https://www.linkedin.com/in/vdn-amitesh/"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
  <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/>
</svg></a>
            <p><small>Built with just <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bootstrap-fill" viewBox="0 0 16 16">
  <path d="M6.375 7.125V4.658h1.78c.973 0 1.542.457 1.542 1.237 0 .802-.604 1.23-1.764 1.23zm0 3.762h1.898c1.184 0 1.81-.48 1.81-1.377 0-.885-.65-1.348-1.886-1.348H6.375z"/>
  <path d="M4.002 0a4 4 0 0 0-4 4v8a4 4 0 0 0 4 4h8a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4zm1.06 12V3.545h3.399c1.587 0 2.543.809 2.543 2.11 0 .884-.65 1.675-1.483 1.816v.1c1.143.117 1.904.931 1.904 2.033 0 1.488-1.084 2.396-2.888 2.396z"/>
</svg> Bootstrap</small></p>
        </div>
    </footer>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
    -->
  </body>
</html>